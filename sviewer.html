<!DOCTYPE html>
<html>
<head>
	<title>Sviewer</title>
	<script type="text/javascript" src="node_modules/babel-polyfill/dist/polyfill.js"></script>
	<script type="text/javascript" src="glycan-bundle.js"></script>
<style type="text/css">
	* {
  -moz-transition: all 0.5s ease-in-out;
  -o-transition: all 0.5s ease-in-out;
  -webkit-transition: all 0.5s ease-in-out;
  transition: all 0.5s ease-in-out;
}
</style>
</head>
<body>
	<pre id="seqs">
		NeuAc(a2-3)[GlcA(b1-?)]Gal(b1-4)Fuc
		Gal(b1-3)[GlcNAc(b1-4)]GalNAc
		NeuAc(a2-6)[Fuc(a1-4)]Gal(b1-4)GlcNAc(b1-3)[NeuAc(a2-6)Gal(b1-4)GlcNAc(b1-6)]Gal(b1-4)GlcNAc(b1-2)Gal(b1-4)Glc
		NeuAc(a2-3)[GlcA(b1-?)]Gal(b1-4)Gal(b1-4)[NeuAc(a2-3)[GlcA(b1-?)]Gal(b1-4)Gal(b1-6)]GlcNAc
		Fuc(a1-2)[NeuAc(a2-3)]Gal(b1-3)GlcNAc(b1-2)Gal(b1-3)GlcNAc(b1-2)Man(a1-3)[GlcNAc(b1-4)][NeuAc(a2-3)Gal(b1-3)[Fuc(a1-4)]GlcNAc(b1-2)Gal(b1-3)GlcNAc(b1-2)Man(a1-6)]Man(b1-4)GlcNAc(b1-4)[Fuc(a1-6)]GlcNAc
		Fuc(a1-2)[NeuAc(a2-3)]Gal(b1-3)GlcNAc(b1-2)Gal(b1-3)GlcNAc(b1-2)Man(a1-3)[GlcNAc(b1-4)][NeuAc(a2-3)Gal(b1-3)GlcNAc(b1-2)Gal(b1-3)GlcNAc(b1-2)[NeuAc(a2-3)Gal(b1-3)[Fuc(a1-4)]GlcNAc(b1-2)Gal(b1-3)GlcNAc(b1-6)]Man(a1-6)]Man(b1-4)GlcNAc(b1-4)[Fuc(a1-6)]GlcNAc
		Fuc(a1-2)[NeuAc(a2-3)]GalNAc(b1-4)GlcNAc(b1-2)GalNAc(b1-4)GlcNAc(b1-2)[Fuc(a1-2)[NeuAc(a2-3)]Gal(b1-3)GlcNAc(b1-2)Gal(b1-3)GlcNAc(b1-6)]Man(a1-3)[GlcNAc(b1-4)][NeuAc(a2-3)Gal(b1-3)[Fuc(a1-4)]GlcNAc(b1-2)Gal(b1-3)GlcNAc(b1-2)Man(a1-6)]Man(b1-4)GlcNAc(b1-4)[Fuc(a1-6)]GlcNAc
	</pre>
	<textarea id="seq" >NeuAc(a2-3)[GlcA(b1-?)]Gal(b1-4)Fuc</textarea>
	<div id="output">
	</div>
<script type="text/javascript">
	let clear_sequences = function() {
		document.getElementById('output').innerHTML = '';
	};
	let append_sequence = function(seq) {
		if ( ! seq ) {
			return;
		}
		console.log(seq);
		let sug = new Glycan.IupacSugar();
		sug.sequence = seq;
		let output = document.createElement('div');
		output.style.width = '200px';
		output.style.height = '300px';
		output.style.float = 'left';
		document.getElementById('output').appendChild(output);
		let renderer = new Glycan.SVGRenderer(output,Glycan.SugarAwareLayout);
		renderer.addSugar(sug);
		setInterval(function() {
			let residues = sug.composition();
			let targ = residues[Math.floor(Math.random()*residues.length)];
			if (targ.identifier === 'Fuc' || targ.identifier === 'NeuAc') {
				return;
			}
			let new_res = new Glycan.Monosaccharide('Gal');
			new_res.anomer = 'a';
			new_res.parent_link = 1;
			targ.addChild(4,new_res);
			targ = new_res;
			renderer.refresh();
		},1000);
		renderer.refresh();
		output.firstChild.style.width = '100%';
		output.firstChild.style.height = '100%';		
	};
	let load_all_seqs = function() {
		clear_sequences();
		console.log("Here");
		for (let seq of document.getElementById('seqs').textContent.split('\n')) {
			append_sequence(seq.trim());
		}
		append_sequence(document.getElementById('seq').value);		
	};

	window.onload = function() {
		load_all_seqs();
		document.getElementById('seq').onchange = function() {
			load_all_seqs();
		};
	};
</script>
</body>
</html>